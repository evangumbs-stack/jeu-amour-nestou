<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jeu d'Amour pour Nestou ğŸ’–</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
body{background:black;color:white;overflow:hidden;position:relative;}
.container{height:100vh;overflow-y:scroll;scroll-snap-type:y mandatory;}
.section{min-height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:20px; scroll-snap-align:start;}
.section.puzzleSection{justify-content:center;}
button{padding:12px 20px;margin:10px;border:none;border-radius:10px;background:#ff4da6;color:white;font-size:16px;cursor:pointer;}
h1,h2{margin-bottom:15px;text-align:center;}
.score{position:fixed;top:10px;right:10px;background:#ff4da6;padding:10px;border-radius:10px;z-index:10;}
.popHeart{position:absolute;font-size:25px;animation:pop 0.6s ease-out;}
@keyframes pop{0%{transform:scale(0);opacity:1;}50%{transform:scale(1.3);}100%{transform:scale(0);opacity:0;}}
#stars{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2;overflow:hidden;}
.star{position:absolute;width:2px;height:2px;background:white;border-radius:50%;opacity:0.8;}
.shooting{position:absolute;width:3px;height:3px;background:white;border-radius:50%;box-shadow:0 0 10px white;}
#gameArea,#gameArea2,#gameArea3,#puzzleArea{position:relative;width:90%;max-width:500px; height:60vh;overflow:hidden; display:flex; flex-wrap:wrap; justify-content:center; align-items:center;}
.item{position:absolute;font-size:30px;cursor:pointer;}
#basket{font-size:50px;position:absolute;bottom:180px;left:50%;transform:translateX(-50%);z-index:10;cursor:pointer;display:none;}
#basketFill{position:absolute;bottom:0;left:0;width:0%;height:30px;background:#ff4da6;border-radius:5px;pointer-events:none;}
#ticTacToe{display:grid;grid-template-columns:repeat(3,80px);gap:5px;margin-top:20px;}
.cell{width:80px;height:80px;background:#111a3a;color:white;font-size:30px;display:flex;justify-content:center;align-items:center;border:1px solid #ff4da6;}
.messageNext{margin-top:20px;font-size:18px;color:#ffd6e8;text-align:center;}
.finalHeart{position:absolute;font-size:30px;animation:floatUp 6s linear infinite;opacity:0.3;}
@keyframes floatUp{0%{transform:translateY(100vh) rotate(0deg);}100%{transform:translateY(-50px) rotate(360deg);}}
.finalWord{position:absolute;font-size:24px;color:#ff4da6;opacity:0.2;animation:floatUp 12s linear infinite;}
#finalPhoto{max-width:90%;max-height:80vh;border-radius:20px;margin:20px auto;display:block;}
.puzzlePiece{width:calc(25% - 4px); height:calc(25% - 4px); margin:2px; background-size:400% 400%; cursor:pointer; border:1px solid #fff;}
</style>
</head>
<body>

<div id="stars"></div>
<div class="score">Score : <span id="score">0</span></div>
<audio id="music" src="TA_MUSIQUE.mp3" loop></audio>
<button style="position:fixed;top:50px;right:10px;z-index:10;" onclick="toggleMusic()">â¯ï¸ Musique</button>

<div class="container">
<section class="section">
<h1>ğŸ’– Jeu d'Amour pour Nestou ğŸ’–</h1>
<p>Anne Esther, tu es mon trÃ©sor âœ¨ğŸ’–</p>
<button onclick="playMusic()">ğŸµ Lancer la musique</button>
<p>DÃ©file vers le bas â¬‡ï¸</p>
</section>

<section class="section">
<h2>Moment prÃ©fÃ©rÃ© ensemble ? ğŸ˜</h2>
<button onclick="answerAnim('moment','Miguel ğŸ¶',this)">Miguel ğŸ¶</button>
<button onclick="answerAnim('moment','Coucher de soleil ğŸŒ…',this)">Coucher de soleil ğŸŒ…</button>
<button onclick="answerAnim('moment','St Barth âœˆï¸',this)">St Barth âœˆï¸</button>
<button onclick="answerAnim('moment','Films ğŸ¬',this)">Films ğŸ¬</button>
</section>

<section class="section">
<h2>ActivitÃ© prÃ©fÃ©rÃ©e avec moi ? ğŸ’•</h2>
<button onclick="answerAnim('activity','Plage ğŸ–ï¸',this)">Plage ğŸ–ï¸</button>
<button onclick="answerAnim('activity','Lego ğŸ§±',this)">Lego ğŸ§±</button>
<button onclick="answerAnim('activity','Sushis ğŸ£',this)">Sushis ğŸ£</button>
<button onclick="answerAnim('activity','Sport ğŸƒâ€â™€ï¸',this)">Sport ğŸƒâ€â™€ï¸</button>
</section>

<section class="section">
<h2>Ton surnom prÃ©fÃ©rÃ© ? ğŸ˜˜</h2>
<button onclick="answerAnim('surnom','Ma Nestou ğŸ’–',this)">Ma Nestou ğŸ’–</button>
<button onclick="answerAnim('surnom','Mon trÃ©sor ğŸ’',this)">Mon trÃ©sor ğŸ’</button>
<button onclick="answerAnim('surnom','Mon amour â¤ï¸',this)">Mon amour â¤ï¸</button>
</section>

<section class="section">
<h2>Film ou sÃ©rie prÃ©fÃ©rÃ©e ? ğŸ¬</h2>
<button onclick="answerAnim('film','Malcom and Marie',this)">Malcom and Marie</button>
<button onclick="answerAnim('film','Eternal Sunshine',this)">Eternal Sunshine</button>
<button onclick="answerAnim('film','Waves',this)">Waves</button>
</section>

<section class="section puzzleSection">
<h2>ğŸ’– Puzzle 4x4 ğŸ’–</h2>
<div id="puzzleArea"></div>
<p class="messageNext" id="msgPuzzle"></p>
<button onclick="startPuzzle()">Lancer le puzzle</button>
</section>

<section class="section">
<h2>ğŸ± Attrape les chatons !</h2>
<div id="gameArea2"></div>
<p class="messageNext" id="msg2"></p>
<button onclick="startMiniGame2()">Lancer</button>
</section>

<section class="section">
<h2>ğŸ§º Panier de cÅ“urs !</h2>
<div id="gameArea3"></div>
<div id="basket">ğŸ§º<div id="basketFill"></div></div>
<p class="messageNext" id="msg3"></p>
<button onclick="startMiniGame3()">Lancer</button>
</section>

<section class="section">
<h2>âŒ Tic Tac Toe ğŸ’•</h2>
<div id="ticTacToe"></div>
<p class="messageNext" id="msg4"></p>
<button onclick="startMiniGame4()">Lancer</button>
</section>

<section class="section">
<h1>ğŸŒ¹ Ma Nestou ğŸŒ¹</h1>
<img id="finalPhoto" src="photo.jpg" alt="Nous deux">
<p id="finalMsg"></p>
</section>
</div>

<script>
// ===== Variables =====
let score=0, scoreGames=[0,0,0,0], answers={};
let music=document.getElementById("music"), musicPlaying=false;
function playMusic(){music.play();musicPlaying=true;}
function toggleMusic(){if(musicPlaying){music.pause();musicPlaying=false;}else{music.play();musicPlaying=true;}}
function updateScore(){document.getElementById("score").innerText=score;}

// ===== Question animation =====
function answerAnim(key,val,btn){
  answers[key]=val;
  const pop=document.createElement("div");
  pop.className="popHeart"; pop.innerText="ğŸ’–";
  const rect=btn.getBoundingClientRect();
  pop.style.left=rect.left+rect.width/2+"px";
  pop.style.top=rect.top-10+"px";
  document.body.appendChild(pop);
  setTimeout(()=>pop.remove(),600);
}

// ===== Stars =====
for(let i=0;i<100;i++){
  let s=document.createElement("div"); s.className="star";
  s.style.top=Math.random()*100+"%"; s.style.left=Math.random()*100+"%";
  s.style.width=Math.random()*2+1+"px"; s.style.height=s.style.width;
  document.getElementById("stars").appendChild(s);
}
function shootingStar(){
  let s=document.createElement("div"); s.className="shooting";
  s.style.top=Math.random()*50+"%"; s.style.left="-5%";
  document.getElementById("stars").appendChild(s);
  let id=setInterval(()=>{
    let left=parseFloat(s.style.left);
    if(left>105){s.remove();clearInterval(id);}else{s.style.left=(left+2)+"%";s.style.top=(parseFloat(s.style.top)+0.5)+"%";}
  },20);
}
setInterval(shootingStar,2000);

// ===== Puzzle 4x4 =====
let puzzlePieces=[], firstPiece=null, puzzleTimer;
function startPuzzle(){
  const area=document.getElementById("puzzleArea");
  area.innerHTML=""; puzzlePieces=[]; firstPiece=null; 
  const size=4; // 4x4
  let numbers=[];
  for(let i=0;i<size*size;i++) numbers.push(i);
  numbers.sort(()=>Math.random()-0.5); // mÃ©lange
  for(let i=0;i<numbers.length;i++){
    let p=document.createElement("div");
    p.className="puzzlePiece";
    p.style.backgroundImage='url("IMAGE_PUZZLE.png")';
    let row=Math.floor(numbers[i]/size), col=numbers[i]%size;
    p.style.backgroundPosition=`${col*25}% ${row*25}%`;
    p.dataset.index=i;
    p.onclick=()=>{handlePuzzleClick(p);}
    puzzlePieces.push(p); area.appendChild(p);
  }
  document.getElementById("msgPuzzle").innerText="RÃ©sous le puzzle en 1min30 !";
  let timeLeft=90;
  clearInterval(puzzleTimer);
  puzzleTimer=setInterval(()=>{
    timeLeft--;
    if(timeLeft<=0){clearInterval(puzzleTimer); document.getElementById("msgPuzzle").innerText="Temps Ã©coulÃ© !"; checkPuzzle();}
  },1000);
}

function handlePuzzleClick(piece){
  if(!firstPiece){firstPiece=piece; piece.style.border="2px solid #ff4da6"; return;}
  // Ã©change positions
  let tempPos=firstPiece.style.order || firstPiece.dataset.index;
  firstPiece.style.order = piece.style.order || piece.dataset.index;
  piece.style.order = tempPos;
  firstPiece.style.border="1px solid #fff";
  firstPiece=null;
  checkPuzzle();
}

function checkPuzzle(){
  let correct=true;
  for(let i=0;i<puzzlePieces.length;i++){
    if((puzzlePieces[i].style.order || puzzlePieces[i].dataset.index) != i){correct=false; break;}
  }
  if(correct){document.getElementById("msgPuzzle").innerText="ğŸ‰ Puzzle terminÃ© !"; score+=10; scoreGames[0]++; updateScore(); clearInterval(puzzleTimer);}
}

// ===== Mini-jeu chatons =====
function startMiniGame2(){
  const area=document.getElementById("gameArea2"); area.innerHTML="";
  let interval=setInterval(()=>{
    const c=document.createElement("div"); c.className="item"; c.innerText="ğŸ±";
    c.style.left=Math.random()*(area.offsetWidth-30)+"px"; c.style.top="-30px";
    area.appendChild(c);
    let fall=setInterval(()=>{
      let top=parseFloat(c.style.top);
      if(top>area.offsetHeight){c.remove();clearInterval(fall);} else{c.style.top=(top+3)+"px";}
    },20);
    c.onclick=c.ontouchstart=()=>{c.remove();score++;scoreGames[1]++;updateScore();}
  },600);
  setTimeout(()=>{clearInterval(interval);document.getElementById("msg2").innerText="â¬‡ï¸ Slide vers le jeu suivant â¬‡ï¸";},15000);
}

// ===== Mini-jeu panier 20s =====
function startMiniGame3(){
  const area=document.getElementById("gameArea3"); area.innerHTML=""; 
  const basket=document.getElementById("basket"); 
  const fill=document.getElementById("basketFill");
  basket.style.display="block"; fill.style.width="0%"; fill.style.height="30px";
  let collected=0; const maxCollect=30; 
  basket.onmousedown=basket.ontouchstart=(e)=>{
    let offsetX=(e.clientX||e.touches[0].clientX)-basket.offsetLeft; 
    document.onmousemove=document.ontouchmove=(ev)=>{
      let basketX=(ev.clientX||ev.touches[0].clientX)-offsetX;
      if(basketX<0) basketX=0; if(basketX>area.offsetWidth-basket.offsetWidth) basketX=area.offsetWidth-basket.offsetWidth;
      basket.style.left=basketX+"px";
    }
  };
  document.onmouseup=document.ontouchend=()=>{document.onmousemove=null;document.ontouchmove=null;};
  let interval=setInterval(()=>{
    const h=document.createElement("div"); h.className="item"; h.innerText="ğŸ’–";
    h.style.left=Math.random()*(area.offsetWidth-30)+"px"; h.style.top="-30px"; area.appendChild(h);
    let fall=setInterval(()=>{
      let top=parseFloat(h.style.top);
      if(top>area.offsetHeight){h.remove();clearInterval(fall);}
      else{
        h.style.top=(top+3)+"px";
        const hRect=h.getBoundingClientRect(); const bRect=basket.getBoundingClientRect();
        if(!(hRect.right<bRect.left||hRect.left>bRect.right||hRect.bottom<bRect.top||hRect.top>bRect.bottom)){
          h.remove(); clearInterval(fall); collected++; score++; scoreGames[2]++; updateScore();
          fill.style.width=Math.min(100,(collected/maxCollect*100))+"%";
        }
      }
    },20);
  },500);
  setTimeout(()=>{clearInterval(interval);basket.style.display="none";document.getElementById("msg3").innerText="â¬‡ï¸ Slide vers le jeu suivant â¬‡ï¸";},20000);
}

// ===== Tic Tac Toe vs IA =====
function startMiniGame4(){
  const grid=document.getElementById("ticTacToe"); grid.innerHTML=""; let board=["","","","","","","","",""];
  let human="ğŸ£", ai="ğŸˆ", current=human;
  let time=15; const timer=document.createElement("p"); timer.id="timerTTT"; timer.innerText=time; grid.parentNode.insertBefore(timer,grid);
  for(let i=0;i<9;i++){
    let c=document.createElement("div"); c.className="cell";
    c.onclick=()=>{if(board[i]==="" && current===human){board[i]=human;c.innerText=human;score++;scoreGames[3]++;updateScore(); if(!checkTTTWin()) aiMove();}}
    grid.appendChild(c);
  }
  const countdown=setInterval(()=>{time--; timer.innerText=time; if(time<=0){clearInterval(countdown);document.getElementById("msg4").innerText="â¬‡ï¸ Slide vers le message final â¬‡ï¸"; showFinal();}},1000);

  function aiMove(){
    current=ai;
    setTimeout(()=>{
      let emptyCells=[];
      for(let i=0;i<9;i++) if(board[i]==="") emptyCells.push(i);
      if(emptyCells.length===0) return;
      let move=emptyCells[Math.floor(Math.random()*emptyCells.length)];
      board[move]=ai;
      grid.children[move].innerText=ai;
      score++; scoreGames[3]++; updateScore();
      checkTTTWin(); current=human;
    },1000+Math.random()*1000);
  }

  function checkTTTWin(){
    const winComb=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(let c of winComb){
      if(board[c[0]]!=="" && board[c[0]]===board[c[1]] && board[c[0]]===board[c[2]]) return true;
    }
    return false;
  }
}

// ===== Message final =====
function showFinal(){
  const finalMsg=document.getElementById("finalMsg");
  finalMsg.innerText=
`ğŸ’– Mon amour ğŸ’–

Tes rÃ©ponses :
- Moment prÃ©fÃ©rÃ© : ${answers.moment||"Non choisi"}
- ActivitÃ© : ${answers.activity||"Non choisi"}
- Surnom : ${answers.surnom||"Non choisi"}
- Film/SÃ©rie : ${answers.film||"Non choisi"}

Scores des jeux :
- Puzzle : ${scoreGames[0]}
- Chatons : ${scoreGames[1]}
- Panier : ${scoreGames[2]}
- Tic Tac Toe : ${scoreGames[3]}

Score total : ${score}

Chaque moment avec toi est prÃ©cieux : nos Lego, nos plages, nos couchers de soleil, nos voyages, nos sushis, nos sÃ©riesâ€¦ tout est plus beau avec toi.
Merci pour ton amour, ta patience et ta douceur. Tu es mon bonheur, mon refuge et mon cÅ“ur. ğŸ’–`;

  for(let i=0;i<50;i++){
    let h=document.createElement("div"); h.className="finalHeart"; h.innerText="ğŸ’–";
    h.style